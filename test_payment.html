<!DOCTYPE html>
<html>
<head>
    <title>Test Payment Form</title>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 600px;
            margin: 50px auto;
            padding: 20px;
        }
        .form-group {
            margin: 15px 0;
        }
        label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
        }
        input, select, textarea {
            width: 100%;
            padding: 8px;
            border: 1px solid #ccc;
            border-radius: 4px;
            font-size: 14px;
            box-sizing: border-box;
        }
        button {
            background: #007bff;
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 16px;
        }
        button:hover {
            background: #0056b3;
        }
        .result {
            margin-top: 20px;
            padding: 15px;
            border-radius: 4px;
            display: none;
        }
        .success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        .error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
    </style>
</head>
<body>
    <h1>üß™ Test Payment AJAX</h1>

    <div style="background: #fff3cd; padding: 10px; margin-bottom: 20px; border-radius: 4px;">
        <strong>‚ö†Ô∏è ‡∏ß‡∏¥‡∏ò‡∏µ‡πÉ‡∏ä‡πâ:</strong>
        <ol>
            <li>‡πÑ‡∏õ‡∏ó‡∏µ‡πà‡∏´‡∏ô‡πâ‡∏≤ PigEntry (http://localhost:8000/pig_entry_records)</li>
            <li>‡πÄ‡∏õ‡∏¥‡∏î Browser DevTools (F12)</li>
            <li>‡πÑ‡∏õ‡∏ó‡∏µ‡πà Console tab</li>
            <li>‡∏£‡∏±‡∏ô‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á‡∏ô‡∏µ‡πâ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÑ‡∏î‡πâ CSRF token:
                <pre style="background: #f0f0f0; padding: 8px; margin-top: 5px; border-radius: 3px;">
document.querySelector('input[name="_token"]').value
                </pre>
            </li>
            <li>‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å token ‡∏ó‡∏µ‡πà‡πÑ‡∏î‡πâ‡∏°‡∏≤</li>
            <li>‡∏°‡∏≤‡∏Å‡∏•‡∏±‡∏ö‡∏°‡∏≤‡∏ó‡∏µ‡πà test page ‡∏ô‡∏µ‡πâ</li>
            <li>‡∏ß‡∏≤‡∏á token ‡πÉ‡∏ô‡∏ä‡πà‡∏≠‡∏á CSRF Token ‡∏î‡πâ‡∏≤‡∏ô‡∏•‡πà‡∏≤‡∏á</li>
        </ol>
    </div>

    <form id="testPaymentForm" enctype="multipart/form-data">
        <div class="form-group">
            <label>CSRF Token (‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏´‡∏ô‡πâ‡∏≤ PigEntry):</label>
            <input type="text" id="csrfToken" placeholder="‡∏ß‡∏≤‡∏á token ‡∏ó‡∏µ‡πà‡∏ô‡∏µ‡πà" required style="font-family: monospace; font-size: 12px;">
        </div>

        <div class="form-group">
            <label>PigEntry ID:</label>
            <input type="number" id="recordId" value="45" required>
        </div>

        <div class="form-group">
            <label>‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏á‡∏¥‡∏ô‡∏ó‡∏µ‡πà‡∏ä‡∏≥‡∏£‡∏∞:</label>
            <input type="number" name="paid_amount" step="0.01" value="100000" required>
        </div>

        <div class="form-group">
            <label>‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏ä‡∏≥‡∏£‡∏∞:</label>
            <input type="date" name="payment_date" value="2025-10-26" required>
        </div>

        <div class="form-group">
            <label>‡∏ß‡∏¥‡∏ò‡∏µ‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô:</label>
            <select name="payment_method" required>
                <option value="">-- ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å --</option>
                <option value="‡πÄ‡∏á‡∏¥‡∏ô‡∏™‡∏î">‡πÄ‡∏á‡∏¥‡∏ô‡∏™‡∏î</option>
                <option value="‡πÇ‡∏≠‡∏ô‡πÄ‡∏á‡∏¥‡∏ô">‡πÇ‡∏≠‡∏ô‡πÄ‡∏á‡∏¥‡∏ô</option>
                <option value="‡πÄ‡∏ä‡πá‡∏Ñ">‡πÄ‡∏ä‡πá‡∏Ñ</option>
            </select>
        </div>

        <div class="form-group">
            <label>‡πÄ‡∏•‡∏Ç‡∏ó‡∏µ‡πà‡∏≠‡πâ‡∏≤‡∏á‡∏≠‡∏¥‡∏á:</label>
            <input type="text" name="reference_number" placeholder="‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á: CHK12345">
        </div>

        <div class="form-group">
            <label>‡∏ä‡∏∑‡πà‡∏≠‡∏ò‡∏ô‡∏≤‡∏Ñ‡∏≤‡∏£:</label>
            <input type="text" name="bank_name" placeholder="‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á: ‡∏ò‡∏ô‡∏≤‡∏Ñ‡∏≤‡∏£‡∏Å‡∏£‡∏∏‡∏á‡πÑ‡∏ó‡∏¢">
        </div>

        <div class="form-group">
            <label>‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î‡∏´‡∏•‡∏±‡∏Å‡∏ê‡∏≤‡∏ô‡∏Å‡∏≤‡∏£‡∏ä‡∏≥‡∏£‡∏∞ (‡πÉ‡∏ä‡πâ‡πÑ‡∏ü‡∏•‡πå‡∏à‡∏£‡∏¥‡∏á‡∏´‡∏£‡∏∑‡∏≠ base64 test):</label>
            <input type="file" name="receipt_file" accept="image/*,application/pdf" required>
            <small style="color: #666;">üí° ‡∏ñ‡πâ‡∏≤‡πÑ‡∏°‡πà‡∏°‡∏µ‡πÑ‡∏ü‡∏•‡πå‡∏à‡∏£‡∏¥‡∏á ‡πÉ‡∏´‡πâ‡∏™‡∏£‡πâ‡∏≤‡∏á test file ‡∏á‡πà‡∏≤‡∏¢‡πÜ: paint.exe save as jpg ‡∏´‡∏£‡∏∑‡∏≠ ‡πÉ‡∏ä‡πâ base64 fake file</small>
        </div>

        <div class="form-group">
            <label>‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏:</label>
            <textarea name="note" rows="3" placeholder="‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏°"></textarea>
        </div>

        <button type="button" onclick="submitPaymentTest()">üì§ ‡∏™‡πà‡∏á Payment AJAX</button>
    </form>

    <div id="result" class="result"></div>

    <script>
        function submitPaymentTest() {
            const recordId = document.getElementById('recordId').value;
            const form = document.getElementById('testPaymentForm');
            const resultDiv = document.getElementById('result');

            console.log('üöÄ Starting payment test with recordId:', recordId);

            // Create FormData
            const formData = new FormData(form);

            // Log form data for debugging
            console.log('üìã FormData contents:');
            for (let [key, value] of formData.entries()) {
                if (value instanceof File) {
                    console.log(`  ${key}: File(${value.name}, ${value.size} bytes, ${value.type})`);
                } else {
                    console.log(`  ${key}: ${value}`);
                }
            }

            // Submit AJAX
            fetch(`/pigentryrecord/${recordId}/payment`, {
                method: 'PUT',
                headers: {
                    'X-CSRF-TOKEN': document.getElementById('csrfToken').value,
                    'Accept': 'application/json',
                },
                body: formData
            })
            .then(response => {
                console.log('üì¨ Response received:', response.status);
                return response.json().then(data => ({
                    status: response.status,
                    data: data
                }));
            })
            .then(result => {
                console.log('‚úÖ Response data:', result);

                const resultDiv = document.getElementById('result');
                resultDiv.className = result.data.success ? 'result success' : 'result error';
                resultDiv.innerHTML = `<strong>${result.data.message}</strong>`;
                resultDiv.style.display = 'block';
            })
            .catch(error => {
                console.error('‚ùå Error:', error);
                resultDiv.className = 'result error';
                resultDiv.innerHTML = `<strong>‚ùå Error: ${error.message}</strong>`;
                resultDiv.style.display = 'block';
            });
        }
    </script>
</body>
</html>
