# üì¶ PigInventoryHelper - ‡∏Ñ‡∏π‡πà‡∏°‡∏∑‡∏≠‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô

## üéØ ‡∏à‡∏∏‡∏î‡∏õ‡∏£‡∏∞‡∏™‡∏á‡∏Ñ‡πå

Helper ‡∏ô‡∏µ‡πâ‡∏ó‡∏≥‡∏´‡∏ô‡πâ‡∏≤‡∏ó‡∏µ‡πà‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏´‡∏°‡∏π‡πÉ‡∏ô‡∏£‡∏∞‡∏ö‡∏ö‡πÉ‡∏´‡πâ‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á‡πÅ‡∏•‡∏∞‡∏™‡∏≠‡∏î‡∏Ñ‡∏•‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ô‡∏ó‡∏±‡πâ‡∏á 2 ‡∏ï‡∏≤‡∏£‡∏≤‡∏á:
1. **`batch_pen_allocations`** - ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏´‡∏°‡∏π‡πÉ‡∏ô‡πÅ‡∏ï‡πà‡∏•‡∏∞‡πÄ‡∏•‡πâ‡∏≤-‡∏Ñ‡∏≠‡∏Å
2. **`batches`** - ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏´‡∏°‡∏π‡∏£‡∏ß‡∏°‡∏Ç‡∏≠‡∏á‡∏£‡∏∏‡πà‡∏ô

---

## üìä ‡πÇ‡∏Ñ‡∏£‡∏á‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•

### ‡∏ï‡∏≤‡∏£‡∏≤‡∏á `batches`
```
id | batch_code | total_pig_amount | current_quantity
1  | BATCH-001  | 500             | 450
```
- **`total_pig_amount`** = ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏´‡∏°‡∏π‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡∏ó‡∏µ‡πà‡∏ã‡∏∑‡πâ‡∏≠‡πÄ‡∏Ç‡πâ‡∏≤‡∏°‡∏≤ (‡πÑ‡∏°‡πà‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô)
- **`current_quantity`** = ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏´‡∏°‡∏π‡∏ó‡∏µ‡πà‡πÄ‡∏´‡∏•‡∏∑‡∏≠‡∏≠‡∏¢‡∏π‡πà‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô (‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏ï‡∏≤‡∏°‡∏Å‡∏≤‡∏£‡∏Ç‡∏≤‡∏¢/‡∏ï‡∏≤‡∏¢)

### ‡∏ï‡∏≤‡∏£‡∏≤‡∏á `batch_pen_allocations`
```
id | batch_id | barn_id | pen_id | pig_amount | current_quantity
1  | 1        | 1       | 1      | 100        | 95
2  | 1        | 1       | 2      | 150        | 145
3  | 1        | 2       | 3      | 250        | 210
```
- **`pig_amount`** = ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏´‡∏°‡∏π‡∏ó‡∏µ‡πà‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡πÉ‡∏™‡πà‡πÄ‡∏Ç‡πâ‡∏≤‡πÄ‡∏•‡πâ‡∏≤-‡∏Ñ‡∏≠‡∏Å (‡πÑ‡∏°‡πà‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô)
- **`current_quantity`** = ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏´‡∏°‡∏π‡∏ó‡∏µ‡πà‡πÄ‡∏´‡∏•‡∏∑‡∏≠‡∏≠‡∏¢‡∏π‡πà‡πÉ‡∏ô‡πÄ‡∏•‡πâ‡∏≤-‡∏Ñ‡∏≠‡∏Å (‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏ï‡∏≤‡∏°‡∏Å‡∏≤‡∏£‡∏Ç‡∏≤‡∏¢/‡∏ï‡∏≤‡∏¢)

---

## üõ†Ô∏è ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏°‡∏µ‡πÉ‡∏´‡πâ‡πÉ‡∏ä‡πâ

### 1. `addPigs()` - ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏´‡∏°‡∏π‡πÄ‡∏Ç‡πâ‡∏≤‡∏£‡∏∞‡∏ö‡∏ö

**‡πÉ‡∏ä‡πâ‡πÄ‡∏°‡∏∑‡πà‡∏≠:** ‡∏ã‡∏∑‡πâ‡∏≠‡∏´‡∏°‡∏π‡πÄ‡∏Ç‡πâ‡∏≤‡∏°‡∏≤‡πÉ‡∏´‡∏°‡πà

**‡∏û‡∏≤‡∏£‡∏≤‡∏°‡∏¥‡πÄ‡∏ï‡∏≠‡∏£‡πå:**
- `$batchId` (int) - ‡∏£‡∏´‡∏±‡∏™‡∏£‡∏∏‡πà‡∏ô
- `$barnId` (int) - ‡∏£‡∏´‡∏±‡∏™‡πÄ‡∏•‡πâ‡∏≤
- `$penId` (int) - ‡∏£‡∏´‡∏±‡∏™‡∏Ñ‡∏≠‡∏Å
- `$quantity` (int) - ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏´‡∏°‡∏π‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡πÄ‡∏û‡∏¥‡πà‡∏°

**‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô:**

```php
use App\Helpers\PigInventoryHelper;

// ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏´‡∏°‡∏π 50 ‡∏ï‡∏±‡∏ß‡πÄ‡∏Ç‡πâ‡∏≤‡πÄ‡∏•‡πâ‡∏≤ 1 ‡∏Ñ‡∏≠‡∏Å 1 ‡∏Ç‡∏≠‡∏á‡∏£‡∏∏‡πà‡∏ô 1
$result = PigInventoryHelper::addPigs(
    batchId: 1,
    barnId: 1,
    penId: 1,
    quantity: 50
);

if ($result['success']) {
    echo $result['message']; // ‚úÖ ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏´‡∏°‡∏π‡πÉ‡∏ô‡πÄ‡∏•‡πâ‡∏≤-‡∏Ñ‡∏≠‡∏Å‡πÄ‡∏î‡∏¥‡∏° (50 ‡∏ï‡∏±‡∏ß)
    // ‡∏´‡∏£‡∏∑‡∏≠ ‚úÖ ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏•‡πâ‡∏≤-‡∏Ñ‡∏≠‡∏Å‡πÉ‡∏´‡∏°‡πà (50 ‡∏ï‡∏±‡∏ß)
} else {
    echo $result['message']; // ‚ùå ‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î: ...
}
```

**‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå:**
```php
[
    'success' => true,
    'message' => '‚úÖ ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏•‡πâ‡∏≤-‡∏Ñ‡∏≠‡∏Å‡πÉ‡∏´‡∏°‡πà (50 ‡∏ï‡∏±‡∏ß)',
    'data' => [
        'quantity_added' => 50,
        'allocation_id' => 4,
        'batch' => [
            'total_pig_amount' => 550,
            'current_quantity' => 500
        ]
    ]
]
```

---

### 2. `reducePigInventory()` - ‡∏•‡∏î‡∏´‡∏°‡∏π‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö

**‡πÉ‡∏ä‡πâ‡πÄ‡∏°‡∏∑‡πà‡∏≠:** ‡∏Ç‡∏≤‡∏¢‡∏´‡∏°‡∏π, ‡∏´‡∏°‡∏π‡∏ï‡∏≤‡∏¢, ‡∏Ñ‡∏±‡∏î‡∏´‡∏°‡∏π‡∏ó‡∏¥‡πâ‡∏á

**‡∏û‡∏≤‡∏£‡∏≤‡∏°‡∏¥‡πÄ‡∏ï‡∏≠‡∏£‡πå:**
- `$batchId` (int) - ‡∏£‡∏´‡∏±‡∏™‡∏£‡∏∏‡πà‡∏ô
- `$penId` (int) - ‡∏£‡∏´‡∏±‡∏™‡πÄ‡∏•‡πâ‡∏≤-‡∏Ñ‡∏≠‡∏Å
- `$quantity` (int) - ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏´‡∏°‡∏π‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏•‡∏î
- `$reason` (string) - ‡πÄ‡∏´‡∏ï‡∏∏‡∏ú‡∏•: `'sale'`, `'death'`, `'culling'`

**‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô:**

```php
use App\Helpers\PigInventoryHelper;

// ‡∏Ç‡∏≤‡∏¢‡∏´‡∏°‡∏π 30 ‡∏ï‡∏±‡∏ß‡∏à‡∏≤‡∏Å‡πÄ‡∏•‡πâ‡∏≤-‡∏Ñ‡∏≠‡∏Å 1 ‡∏Ç‡∏≠‡∏á‡∏£‡∏∏‡πà‡∏ô 1
$result = PigInventoryHelper::reducePigInventory(
    batchId: 1,
    penId: 1,
    quantity: 30,
    reason: 'sale'
);

if ($result['success']) {
    echo $result['message']; // ‚úÖ ‡∏•‡∏î‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏´‡∏°‡∏π‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢ (30 ‡∏ï‡∏±‡∏ß)
    
    $data = $result['data'];
    echo "‡πÄ‡∏•‡πâ‡∏≤-‡∏Ñ‡∏≠‡∏Å‡πÄ‡∏´‡∏•‡∏∑‡∏≠: " . $data['pen_allocation']['remaining'] . " ‡∏ï‡∏±‡∏ß";
    echo "‡∏£‡∏∏‡πà‡∏ô‡πÄ‡∏´‡∏•‡∏∑‡∏≠: " . $data['batch']['remaining'] . " ‡∏ï‡∏±‡∏ß";
} else {
    echo $result['message']; // ‚ùå ‡∏´‡∏°‡∏π‡πÉ‡∏ô‡πÄ‡∏•‡πâ‡∏≤-‡∏Ñ‡∏≠‡∏Å‡πÑ‡∏°‡πà‡πÄ‡∏û‡∏µ‡∏¢‡∏á‡∏û‡∏≠
}
```

**‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à:**
```php
[
    'success' => true,
    'message' => '‚úÖ ‡∏•‡∏î‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏´‡∏°‡∏π‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢ (30 ‡∏ï‡∏±‡∏ß)',
    'data' => [
        'reason' => 'sale',
        'quantity_reduced' => 30,
        'pen_allocation' => [
            'before' => 100,
            'after' => 70,
            'remaining' => 70
        ],
        'batch' => [
            'before' => 500,
            'after' => 470,
            'remaining' => 470
        ]
    ]
]
```

**‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå‡∏•‡πâ‡∏°‡πÄ‡∏´‡∏•‡∏ß (‡∏´‡∏°‡∏π‡πÑ‡∏°‡πà‡∏û‡∏≠):**
```php
[
    'success' => false,
    'message' => '‚ùå ‡∏´‡∏°‡∏π‡πÉ‡∏ô‡πÄ‡∏•‡πâ‡∏≤-‡∏Ñ‡∏≠‡∏Å‡πÑ‡∏°‡πà‡πÄ‡∏û‡∏µ‡∏¢‡∏á‡∏û‡∏≠ (‡∏°‡∏µ‡∏≠‡∏¢‡∏π‡πà 70 ‡∏ï‡∏±‡∏ß ‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£ 100 ‡∏ï‡∏±‡∏ß)',
    'data' => [
        'available' => 70,
        'requested' => 100,
        'shortage' => 30
    ]
]
```

---

### 3. `increasePigInventory()` - ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏´‡∏°‡∏π‡∏Å‡∏•‡∏±‡∏ö‡πÄ‡∏Ç‡πâ‡∏≤‡∏£‡∏∞‡∏ö‡∏ö

**‡πÉ‡∏ä‡πâ‡πÄ‡∏°‡∏∑‡πà‡∏≠:** ‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å‡∏Å‡∏≤‡∏£‡∏Ç‡∏≤‡∏¢

**‡∏û‡∏≤‡∏£‡∏≤‡∏°‡∏¥‡πÄ‡∏ï‡∏≠‡∏£‡πå:**
- `$batchId` (int) - ‡∏£‡∏´‡∏±‡∏™‡∏£‡∏∏‡πà‡∏ô
- `$penId` (int) - ‡∏£‡∏´‡∏±‡∏™‡πÄ‡∏•‡πâ‡∏≤-‡∏Ñ‡∏≠‡∏Å
- `$quantity` (int) - ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏´‡∏°‡∏π‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Å‡∏•‡∏±‡∏ö

**‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô:**

```php
use App\Helpers\PigInventoryHelper;

// ‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å‡∏Å‡∏≤‡∏£‡∏Ç‡∏≤‡∏¢ - ‡∏Ñ‡∏∑‡∏ô‡∏´‡∏°‡∏π 30 ‡∏ï‡∏±‡∏ß‡∏Å‡∏•‡∏±‡∏ö‡πÄ‡∏•‡πâ‡∏≤-‡∏Ñ‡∏≠‡∏Å 1
$result = PigInventoryHelper::increasePigInventory(
    batchId: 1,
    penId: 1,
    quantity: 30
);

if ($result['success']) {
    echo $result['message']; // ‚úÖ ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏´‡∏°‡∏π‡∏Å‡∏•‡∏±‡∏ö‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢ (30 ‡∏ï‡∏±‡∏ß)
} else {
    echo $result['message']; // ‚ö†Ô∏è ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏´‡∏°‡∏π‡∏à‡∏∞‡πÄ‡∏Å‡∏¥‡∏ô‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô
}
```

---

### 4. `getPigsByBatch()` - ‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏´‡∏°‡∏π‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡∏Ç‡∏≠‡∏á‡∏£‡∏∏‡πà‡∏ô

**‡πÉ‡∏ä‡πâ‡πÄ‡∏°‡∏∑‡πà‡∏≠:** ‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏î‡∏π‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏´‡∏°‡∏π‡πÅ‡∏¢‡∏Å‡∏ï‡∏≤‡∏°‡πÄ‡∏•‡πâ‡∏≤-‡∏Ñ‡∏≠‡∏Å

**‡∏û‡∏≤‡∏£‡∏≤‡∏°‡∏¥‡πÄ‡∏ï‡∏≠‡∏£‡πå:**
- `$batchId` (int) - ‡∏£‡∏´‡∏±‡∏™‡∏£‡∏∏‡πà‡∏ô

**‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô:**

```php
use App\Helpers\PigInventoryHelper;

$pigs = PigInventoryHelper::getPigsByBatch(1);

echo "‡∏£‡∏∏‡πà‡∏ô‡∏ô‡∏µ‡πâ‡∏°‡∏µ‡∏´‡∏°‡∏π‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î: " . $pigs['summary']['total_pigs'] . " ‡∏ï‡∏±‡∏ß\n";
echo "‡πÄ‡∏´‡∏•‡∏∑‡∏≠‡∏≠‡∏¢‡∏π‡πà: " . $pigs['summary']['current_pigs'] . " ‡∏ï‡∏±‡∏ß\n";

foreach ($pigs['allocations'] as $allocation) {
    echo "‡πÄ‡∏•‡πâ‡∏≤: {$allocation['barn_name']}, ‡∏Ñ‡∏≠‡∏Å: {$allocation['pen_name']}\n";
    echo "‡∏°‡∏µ‡∏´‡∏°‡∏π: {$allocation['current_quantity']} / {$allocation['pig_amount']} ‡∏ï‡∏±‡∏ß\n";
}
```

**‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå:**
```php
[
    'batch_id' => 1,
    'batch_code' => 'BATCH-001',
    'allocations' => [
        [
            'allocation_id' => 1,
            'barn_id' => 1,
            'barn_name' => '‡πÇ‡∏£‡∏á‡πÄ‡∏£‡∏∑‡∏≠‡∏ô A',
            'pen_id' => 1,
            'pen_name' => '‡∏Ñ‡∏≠‡∏Å A1',
            'pig_amount' => 100,
            'current_quantity' => 70,
            'reduced' => 30
        ],
        // ...
    ],
    'summary' => [
        'total_pigs' => 500,
        'current_pigs' => 450,
        'total_reduced' => 50
    ]
]
```

---

### 5. `getPigsByPen()` - ‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏´‡∏°‡∏π‡πÉ‡∏ô‡πÄ‡∏•‡πâ‡∏≤-‡∏Ñ‡∏≠‡∏Å‡πÄ‡∏î‡∏µ‡∏¢‡∏ß

**‡πÉ‡∏ä‡πâ‡πÄ‡∏°‡∏∑‡πà‡∏≠:** ‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏î‡∏π‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏´‡∏°‡∏π‡πÉ‡∏ô‡πÄ‡∏•‡πâ‡∏≤-‡∏Ñ‡∏≠‡∏Å‡πÉ‡∏î‡πÄ‡∏•‡πâ‡∏≤-‡∏Ñ‡∏≠‡∏Å‡∏´‡∏ô‡∏∂‡πà‡∏á

**‡∏û‡∏≤‡∏£‡∏≤‡∏°‡∏¥‡πÄ‡∏ï‡∏≠‡∏£‡πå:**
- `$batchId` (int) - ‡∏£‡∏´‡∏±‡∏™‡∏£‡∏∏‡πà‡∏ô
- `$penId` (int) - ‡∏£‡∏´‡∏±‡∏™‡πÄ‡∏•‡πâ‡∏≤-‡∏Ñ‡∏≠‡∏Å

**‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô:**

```php
use App\Helpers\PigInventoryHelper;

$result = PigInventoryHelper::getPigsByPen(1, 1);

if ($result['success']) {
    $data = $result['data'];
    echo "‡πÄ‡∏•‡πâ‡∏≤-‡∏Ñ‡∏≠‡∏Å‡∏ô‡∏µ‡πâ‡∏°‡∏µ‡∏´‡∏°‡∏π: {$data['current_quantity']} ‡∏ï‡∏±‡∏ß\n";
    echo "‡∏Ñ‡∏ß‡∏≤‡∏°‡∏à‡∏∏: {$data['pen_capacity']} ‡∏ï‡∏±‡∏ß\n";
    echo "‡∏ß‡πà‡∏≤‡∏á: {$data['available_space']} ‡∏ï‡∏±‡∏ß\n";
}
```

**‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå:**
```php
[
    'success' => true,
    'data' => [
        'allocation_id' => 1,
        'batch_id' => 1,
        'barn_id' => 1,
        'pen_id' => 1,
        'pig_amount' => 100,
        'current_quantity' => 70,
        'pen_capacity' => 100,
        'available_space' => 30,
        'utilization_rate' => 70.0
    ]
]
```

---

### 6. `getAvailablePensByBatch()` - ‡∏î‡∏π‡πÄ‡∏•‡πâ‡∏≤-‡∏Ñ‡∏≠‡∏Å‡∏ó‡∏µ‡πà‡∏°‡∏µ‡∏ó‡∏µ‡πà‡∏ß‡πà‡∏≤‡∏á

**‡πÉ‡∏ä‡πâ‡πÄ‡∏°‡∏∑‡πà‡∏≠:** ‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏´‡∏≤‡πÄ‡∏•‡πâ‡∏≤-‡∏Ñ‡∏≠‡∏Å‡∏ó‡∏µ‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏´‡∏°‡∏π‡πÑ‡∏î‡πâ

**‡∏û‡∏≤‡∏£‡∏≤‡∏°‡∏¥‡πÄ‡∏ï‡∏≠‡∏£‡πå:**
- `$batchId` (int) - ‡∏£‡∏´‡∏±‡∏™‡∏£‡∏∏‡πà‡∏ô
- `$requiredSpace` (int, optional) - ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£

**‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô:**

```php
use App\Helpers\PigInventoryHelper;

// ‡∏´‡∏≤‡πÄ‡∏•‡πâ‡∏≤-‡∏Ñ‡∏≠‡∏Å‡∏ó‡∏µ‡πà‡∏°‡∏µ‡∏ó‡∏µ‡πà‡∏ß‡πà‡∏≤‡∏á‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏ô‡πâ‡∏≠‡∏¢ 50 ‡∏ï‡∏±‡∏ß
$pens = PigInventoryHelper::getAvailablePensByBatch(1, 50);

foreach ($pens as $pen) {
    echo "‡πÄ‡∏•‡πâ‡∏≤: {$pen['barn_name']}, ‡∏Ñ‡∏≠‡∏Å: {$pen['pen_name']}\n";
    echo "‡∏ß‡πà‡∏≤‡∏á: {$pen['available_space']} ‡∏ï‡∏±‡∏ß\n";
}
```

---

## üîÑ Workflow ‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡∏à‡∏£‡∏¥‡∏á

### ‡∏™‡∏ñ‡∏≤‡∏ô‡∏Å‡∏≤‡∏£‡∏ì‡πå‡∏ó‡∏µ‡πà 1: ‡∏ã‡∏∑‡πâ‡∏≠‡∏´‡∏°‡∏π‡πÄ‡∏Ç‡πâ‡∏≤‡∏°‡∏≤‡πÉ‡∏´‡∏°‡πà

```php
// ‡πÉ‡∏ô PigEntryController@upload_pig_entry_record

use App\Helpers\PigInventoryHelper;

// ‡∏ß‡∏ô‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏´‡∏°‡∏π‡πÄ‡∏Ç‡πâ‡∏≤‡πÅ‡∏ï‡πà‡∏•‡∏∞‡πÄ‡∏•‡πâ‡∏≤-‡∏Ñ‡∏≠‡∏Å
foreach ($pens as $pen) {
    $result = PigInventoryHelper::addPigs(
        batchId: $batch->id,
        barnId: $barn->id,
        penId: $pen->id,
        quantity: $allocateToPen
    );
    
    if (!$result['success']) {
        throw new Exception($result['message']);
    }
}
```

**‡∏™‡∏¥‡πà‡∏á‡∏ó‡∏µ‡πà‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡∏∂‡πâ‡∏ô‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥:**
1. ‚úÖ ‡∏™‡∏£‡πâ‡∏≤‡∏á/‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏ô `batch_pen_allocations`
2. ‚úÖ ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï `batches.total_pig_amount` ‡πÅ‡∏•‡∏∞ `current_quantity`
3. ‚úÖ ‡πÉ‡∏ä‡πâ Transaction ‡∏õ‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î

---

### ‡∏™‡∏ñ‡∏≤‡∏ô‡∏Å‡∏≤‡∏£‡∏ì‡πå‡∏ó‡∏µ‡πà 2: ‡∏Ç‡∏≤‡∏¢‡∏´‡∏°‡∏π

```php
// ‡πÉ‡∏ô PigSellController@create

use App\Helpers\PigInventoryHelper;

// ‡∏•‡∏î‡∏´‡∏°‡∏π‡∏à‡∏≤‡∏Å‡πÄ‡∏•‡πâ‡∏≤-‡∏Ñ‡∏≠‡∏Å‡∏ó‡∏µ‡πà‡πÄ‡∏•‡∏∑‡∏≠‡∏Å
$result = PigInventoryHelper::reducePigInventory(
    batchId: $batch->id,
    penId: $penId,
    quantity: $quantity,
    reason: 'sale'
);

if (!$result['success']) {
    return redirect()->back()->with('error', $result['message']);
}

// ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡∏Ç‡∏≤‡∏¢
PigSell::create([
    'batch_id' => $batch->id,
    'pen_id' => $penId,
    'quantity' => $quantity,
    // ... ‡∏ü‡∏¥‡∏•‡∏î‡πå‡∏≠‡∏∑‡πà‡∏ô‡πÜ
]);
```

**‡∏™‡∏¥‡πà‡∏á‡∏ó‡∏µ‡πà‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡∏∂‡πâ‡∏ô‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥:**
1. ‚úÖ ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤‡∏´‡∏°‡∏π‡πÄ‡∏û‡∏µ‡∏¢‡∏á‡∏û‡∏≠‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà
2. ‚úÖ ‡∏•‡∏î `batch_pen_allocations.current_quantity`
3. ‚úÖ ‡∏•‡∏î `batches.current_quantity`
4. ‚úÖ Return ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏Å‡πà‡∏≠‡∏ô-‡∏´‡∏•‡∏±‡∏á

---

### ‡∏™‡∏ñ‡∏≤‡∏ô‡∏Å‡∏≤‡∏£‡∏ì‡πå‡∏ó‡∏µ‡πà 3: ‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å‡∏Å‡∏≤‡∏£‡∏Ç‡∏≤‡∏¢

```php
// ‡πÉ‡∏ô PigSellController@cancel

use App\Helpers\PigInventoryHelper;

// ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏´‡∏°‡∏π‡∏Å‡∏•‡∏±‡∏ö‡πÄ‡∏Ç‡πâ‡∏≤‡πÄ‡∏•‡πâ‡∏≤-‡∏Ñ‡∏≠‡∏Å
$result = PigInventoryHelper::increasePigInventory(
    batchId: $sell->batch_id,
    penId: $sell->pen_id,
    quantity: $sell->quantity
);

if (!$result['success']) {
    return redirect()->back()->with('error', $result['message']);
}

// ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞
$sell->update(['sale_status' => '‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å']);
```

**‡∏™‡∏¥‡πà‡∏á‡∏ó‡∏µ‡πà‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡∏∂‡πâ‡∏ô‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥:**
1. ‚úÖ ‡πÄ‡∏û‡∏¥‡πà‡∏° `batch_pen_allocations.current_quantity`
2. ‚úÖ ‡πÄ‡∏û‡∏¥‡πà‡∏° `batches.current_quantity`
3. ‚úÖ ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡πÑ‡∏°‡πà‡πÉ‡∏´‡πâ‡πÄ‡∏Å‡∏¥‡∏ô‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô

---

### ‡∏™‡∏ñ‡∏≤‡∏ô‡∏Å‡∏≤‡∏£‡∏ì‡πå‡∏ó‡∏µ‡πà 4: ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏´‡∏°‡∏π‡∏ï‡∏≤‡∏¢

```php
// ‡πÉ‡∏ô PigDeathController@create

use App\Helpers\PigInventoryHelper;

// ‡∏•‡∏î‡∏´‡∏°‡∏π‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö
$result = PigInventoryHelper::reducePigInventory(
    batchId: $batch->id,
    penId: $penId,
    quantity: $quantity,
    reason: 'death'
);

if (!$result['success']) {
    return redirect()->back()->with('error', $result['message']);
}

// ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡∏ï‡∏≤‡∏¢
PigDeath::create([
    'batch_id' => $batch->id,
    'pen_id' => $penId,
    'quantity' => $quantity,
    'death_date' => $deathDate,
    // ... ‡∏ü‡∏¥‡∏•‡∏î‡πå‡∏≠‡∏∑‡πà‡∏ô‡πÜ
]);
```

---

## ‚ö†Ô∏è ‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏£‡∏£‡∏∞‡∏ß‡∏±‡∏á

### 1. **‡∏≠‡∏¢‡πà‡∏≤‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏´‡∏°‡∏π‡∏î‡πâ‡∏ß‡∏¢‡∏ï‡∏±‡∏ß‡πÄ‡∏≠‡∏á**

‚ùå **‡∏ú‡∏¥‡∏î:**
```php
// ‡∏≠‡∏¢‡πà‡∏≤‡∏ó‡∏≥‡πÅ‡∏ö‡∏ö‡∏ô‡∏µ‡πâ!
$batch = Batch::find(1);
$batch->current_quantity -= 30;
$batch->save();

DB::table('batch_pen_allocations')
    ->where('id', 1)
    ->update(['current_quantity' => DB::raw('current_quantity - 30')]);
```

‚úÖ **‡∏ñ‡∏π‡∏Å:**
```php
// ‡πÉ‡∏ä‡πâ Helper ‡πÅ‡∏ó‡∏ô
PigInventoryHelper::reducePigInventory(
    batchId: 1,
    penId: 1,
    quantity: 30,
    reason: 'sale'
);
```

### 2. **‡πÄ‡∏ä‡πá‡∏Ñ success ‡∏Å‡πà‡∏≠‡∏ô‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£‡∏ï‡πà‡∏≠**

```php
$result = PigInventoryHelper::reducePigInventory(...);

if (!$result['success']) {
    // ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£ error
    return redirect()->back()->with('error', $result['message']);
}

// ‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£‡∏ï‡πà‡∏≠...
```

### 3. **‡πÉ‡∏ä‡πâ Transaction ‡∏ñ‡πâ‡∏≤‡∏°‡∏µ‡∏´‡∏•‡∏≤‡∏¢‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô**

```php
DB::beginTransaction();

try {
    // ‡∏•‡∏î‡∏´‡∏°‡∏π
    $result = PigInventoryHelper::reducePigInventory(...);
    if (!$result['success']) {
        throw new Exception($result['message']);
    }
    
    // ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡∏Ç‡∏≤‡∏¢
    PigSell::create([...]);
    
    // ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô
    Payment::create([...]);
    
    DB::commit();
} catch (Exception $e) {
    DB::rollBack();
    return redirect()->back()->with('error', $e->getMessage());
}
```

---

## üß™ ‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á Response

### Success Response
```php
[
    'success' => true,
    'message' => '‚úÖ ‡∏•‡∏î‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏´‡∏°‡∏π‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢ (30 ‡∏ï‡∏±‡∏ß)',
    'data' => [
        'reason' => 'sale',
        'quantity_reduced' => 30,
        'pen_allocation' => [
            'before' => 100,
            'after' => 70,
            'remaining' => 70
        ],
        'batch' => [
            'before' => 500,
            'after' => 470,
            'remaining' => 470
        ]
    ]
]
```

### Error Response
```php
[
    'success' => false,
    'message' => '‚ùå ‡∏´‡∏°‡∏π‡πÉ‡∏ô‡πÄ‡∏•‡πâ‡∏≤-‡∏Ñ‡∏≠‡∏Å‡πÑ‡∏°‡πà‡πÄ‡∏û‡∏µ‡∏¢‡∏á‡∏û‡∏≠ (‡∏°‡∏µ‡∏≠‡∏¢‡∏π‡πà 70 ‡∏ï‡∏±‡∏ß ‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£ 100 ‡∏ï‡∏±‡∏ß)',
    'data' => [
        'available' => 70,
        'requested' => 100,
        'shortage' => 30
    ]
]
```

---

## üìù ‡∏™‡∏£‡∏∏‡∏õ

### ‚úÖ ‡∏Ç‡πâ‡∏≠‡∏î‡∏µ‡∏Ç‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ Helper:

1. **‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏≠‡∏î‡∏Ñ‡∏•‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ô** - ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏ó‡∏±‡πâ‡∏á 2 ‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏Å‡∏±‡∏ô
2. **‡∏õ‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ô Race Condition** - ‡πÉ‡∏ä‡πâ `lockForUpdate()`
3. **‡πÉ‡∏ä‡πâ Transaction** - Rollback ‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥‡∏ñ‡πâ‡∏≤‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î
4. **‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á** - ‡πÄ‡∏ä‡πá‡∏Ñ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏´‡∏°‡∏π‡πÄ‡∏û‡∏µ‡∏¢‡∏á‡∏û‡∏≠
5. **Return ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Ñ‡∏£‡∏ö‡∏ñ‡πâ‡∏ß‡∏ô** - ‡∏£‡∏π‡πâ‡∏Å‡πà‡∏≠‡∏ô-‡∏´‡∏•‡∏±‡∏á‡∏Å‡∏≤‡∏£‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÅ‡∏õ‡∏•‡∏á
6. **Error Message ‡∏ä‡∏±‡∏î‡πÄ‡∏à‡∏ô** - ‡∏ö‡∏≠‡∏Å‡∏™‡∏≤‡πÄ‡∏´‡∏ï‡∏∏‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î

### üéØ ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÑ‡∏´‡∏£‡πà‡∏Ñ‡∏ß‡∏£‡πÉ‡∏ä‡πâ:

- ‚úÖ ‡∏ã‡∏∑‡πâ‡∏≠‡∏´‡∏°‡∏π‡πÄ‡∏Ç‡πâ‡∏≤ (`addPigs`)
- ‚úÖ ‡∏Ç‡∏≤‡∏¢‡∏´‡∏°‡∏π (`reducePigInventory`)
- ‚úÖ ‡∏´‡∏°‡∏π‡∏ï‡∏≤‡∏¢ (`reducePigInventory`)
- ‚úÖ ‡∏Ñ‡∏±‡∏î‡∏´‡∏°‡∏π‡∏ó‡∏¥‡πâ‡∏á (`reducePigInventory`)
- ‚úÖ ‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å‡∏Å‡∏≤‡∏£‡∏Ç‡∏≤‡∏¢ (`increasePigInventory`)
- ‚úÖ ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏´‡∏°‡∏π (`getPigsByBatch`, `getPigsByPen`)

---

**‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£:** 12 ‡∏ï‡∏∏‡∏•‡∏≤‡∏Ñ‡∏° 2025  
**‡∏ú‡∏π‡πâ‡∏™‡∏£‡πâ‡∏≤‡∏á:** GitHub Copilot  
**‡πÄ‡∏ß‡∏≠‡∏£‡πå‡∏ä‡∏±‡∏ô:** 1.0
