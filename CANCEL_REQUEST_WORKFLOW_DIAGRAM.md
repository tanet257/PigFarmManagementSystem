# Cancel Request Workflow - Diagram

## Complete System Architecture

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     PIG FARM MANAGEMENT SYSTEM                          â”‚
â”‚                    Cancel Request Approval Workflow                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         FARM STAFF INTERFACE                               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                             â”‚
â”‚  Pig Sales List View                                                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”‚
â”‚  â”‚ Sale# 5234 â”‚ 10 pigs â”‚ Price: 2000 â”‚ Status: Incomplete    â”‚        â”‚
â”‚  â”‚ [Payment]  [Cancel]  [Delete]                               â”‚        â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚
â”‚         â†“                                                                  â”‚
â”‚    Click Cancel Button                                                    â”‚
â”‚         â†“                                                                  â”‚
â”‚  Confirmation Dialog                                                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”‚
â”‚  â”‚ Confirm Cancellation                                         â”‚        â”‚
â”‚  â”‚ Reason: [Select dropdown or text]                           â”‚        â”‚
â”‚  â”‚ [Cancel] [Confirm]                                          â”‚        â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚
â”‚         â†“                                                                  â”‚
â”‚  Database: Notification created                                          â”‚
â”‚    - type = 'cancel_pig_sale'                                            â”‚
â”‚    - approval_status = 'pending'                                         â”‚
â”‚    - related_model_id = 5234                                             â”‚
â”‚    - message = [cancel reason]                                           â”‚
â”‚         â†“                                                                  â”‚
â”‚  UI: Brief flash message or redirect                                     â”‚
â”‚  "à¸‚à¸­à¸¢à¸à¹€à¸¥à¸´à¸à¸à¸²à¸£à¸‚à¸²à¸¢à¹à¸¥à¹‰à¸§ à¸£à¸­à¸à¸²à¸£à¸­à¸™à¸¸à¸¡à¸±à¸•à¸´à¸ˆà¸²à¸à¹à¸­à¸”à¸¡à¸´à¸™"                              â”‚
â”‚                                                                             â”‚
â”‚  âœ“ Sale remains ACTIVE                                                   â”‚
â”‚  âœ“ Payment still recordable                                              â”‚
â”‚  âœ“ Cancel button still visible                                           â”‚
â”‚                                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    ADMIN APPROVAL DASHBOARD                                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                             â”‚
â”‚  Payment Approvals Main Page                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”‚
â”‚  â”‚ Status Summary Badges:                                       â”‚        â”‚
â”‚  â”‚ [Pending: 8] [Approved: 25] [Rejected: 3]                  â”‚        â”‚
â”‚  â”‚                                                              â”‚        â”‚
â”‚  â”‚ Tabs: [ğŸ“¥ Pending] [âœ… Approved] [âŒ Rejected]             â”‚        â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚
â”‚                                                                             â”‚
â”‚  PENDING TAB (Active)                                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”‚
â”‚  â”‚ Regular Payment Approvals Table:                             â”‚        â”‚
â”‚  â”‚ â”Œâ”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚        â”‚
â”‚  â”‚ â”‚ #   â”‚ Type     â”‚ Details          â”‚ Recorder â”‚ Action â”‚  â”‚        â”‚
â”‚  â”‚ â”œâ”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”‚        â”‚
â”‚  â”‚ â”‚ 1   â”‚ Payment  â”‚ Sale #5233...    â”‚ John     â”‚ [âœ“][âœ—] â”‚  â”‚        â”‚
â”‚  â”‚ â”‚ 2   â”‚ Pig Entr â”‚ Batch #2024...   â”‚ Jane     â”‚ [âœ“][âœ—] â”‚  â”‚        â”‚
â”‚  â”‚ â””â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚        â”‚
â”‚  â”‚                                                              â”‚        â”‚
â”‚  â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚        â”‚
â”‚  â”‚                                                              â”‚        â”‚
â”‚  â”‚ âš ï¸ à¸‚à¸­à¸¢à¸à¹€à¸¥à¸´à¸à¸à¸²à¸£à¸‚à¸²à¸¢à¸«à¸¡à¸¹ [3]  â† NEW SECTION                   â”‚        â”‚
â”‚  â”‚ â”Œâ”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚        â”‚
â”‚  â”‚ â”‚ #   â”‚ Sale#  â”‚ Qty  â”‚ Requesterâ”‚ Date   â”‚ Reason   â”‚    â”‚        â”‚
â”‚  â”‚ â”œâ”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤    â”‚        â”‚
â”‚  â”‚ â”‚ 1   â”‚ #5234  â”‚ 10à¸•à¸±à¸§â”‚ David    â”‚ 10/1   â”‚ High price   â”‚        â”‚
â”‚  â”‚ â”‚     â”‚        â”‚      â”‚          â”‚        â”‚              â”‚        â”‚
â”‚  â”‚ â”‚     â”‚        â”‚      â”‚ [âœ“ Approve] [âœ— Reject]           â”‚        â”‚
â”‚  â”‚ â”œâ”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤    â”‚        â”‚
â”‚  â”‚ â”‚ 2   â”‚ #5236  â”‚ 5à¸•à¸±à¸§ â”‚ Sarah    â”‚ 10/1   â”‚ Buyer cancel â”‚        â”‚
â”‚  â”‚ â”‚     â”‚        â”‚      â”‚          â”‚        â”‚              â”‚        â”‚
â”‚  â”‚ â”‚     â”‚        â”‚      â”‚ [âœ“ Approve] [âœ— Reject]           â”‚        â”‚
â”‚  â”‚ â”œâ”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤    â”‚        â”‚
â”‚  â”‚ â”‚ 3   â”‚ #5237  â”‚ 8à¸•à¸±à¸§ â”‚ Mike     â”‚ 10/1   â”‚ Quality issueâ”‚        â”‚
â”‚  â”‚ â”‚     â”‚        â”‚      â”‚          â”‚        â”‚              â”‚        â”‚
â”‚  â”‚ â”‚     â”‚        â”‚      â”‚ [âœ“ Approve] [âœ— Reject]           â”‚        â”‚
â”‚  â”‚ â””â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚        â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚
â”‚                                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚               â”‚               â”‚
              APPROVE PATH    REJECT PATH
              â†“                 â†“
              
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   APPROVE CANCEL MODAL     â”‚  â”‚   REJECT CANCEL MODAL      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                            â”‚  â”‚                            â”‚
â”‚ âœ… à¸­à¸™à¸¸à¸¡à¸±à¸•à¸´à¸à¸²à¸£à¸¢à¸à¹€à¸¥à¸´à¸      â”‚  â”‚ âŒ à¸›à¸à¸´à¹€à¸ªà¸˜à¸à¸²à¸£à¸¢à¸à¹€à¸¥à¸´à¸        â”‚
â”‚                            â”‚  â”‚                            â”‚
â”‚ â„¹ï¸ à¹€à¸«à¸•à¸¸à¸œà¸¥à¸à¸²à¸£à¸‚à¸­à¸¢à¸à¹€à¸¥à¸´à¸:    â”‚  â”‚ âš ï¸ à¹€à¸«à¸•à¸¸à¸œà¸¥à¸à¸²à¸£à¸‚à¸­à¸¢à¸à¹€à¸¥à¸´à¸:    â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚  â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚ â”‚ High price / Buyer   â”‚   â”‚  â”‚ â”‚ High price / Buyer   â”‚   â”‚
â”‚ â”‚ cancelled            â”‚   â”‚  â”‚ â”‚ cancelled            â”‚   â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚  â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                            â”‚  â”‚                            â”‚
â”‚ ğŸ“ à¸«à¸¡à¸²à¸¢à¹€à¸«à¸•à¸¸à¸à¸²à¸£à¸­à¸™à¸¸à¸¡à¸±à¸•à¸´:    â”‚  â”‚ ğŸ“ à¹€à¸«à¸•à¸¸à¸œà¸¥à¹ƒà¸™à¸à¸²à¸£à¸›à¸à¸´à¹€à¸ªà¸˜:   â”‚
â”‚ (Optional)                 â”‚  â”‚ (Required) *             â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚  â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚ â”‚ [Text Area] (empty)  â”‚   â”‚  â”‚ â”‚ [Text Area] (must     â”‚   â”‚
â”‚ â”‚                      â”‚   â”‚  â”‚ â”‚  fill!)               â”‚   â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚  â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                            â”‚  â”‚                            â”‚
â”‚ [Cancel] [âœ“ Submit]        â”‚  â”‚ [Cancel] [âœ— Submit]        â”‚
â”‚                            â”‚  â”‚                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
          â”‚                               â”‚
          â”‚                               â”‚
          â†“ HTTP PATCH                    â†“ HTTP PATCH
    approveCancelSale()            rejectCancelSale()
          â”‚                               â”‚
          â”‚                               â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ BACKEND APPROVAL PROCESSING â”‚  â”‚ BACKEND REJECTION PROCESSING â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                             â”‚  â”‚                              â”‚
â”‚ 1. Validate notification    â”‚  â”‚ 1. Validate rejection_reason â”‚
â”‚ 2. Update notification:     â”‚  â”‚ 2. Update notification:      â”‚
â”‚    - approval_status        â”‚  â”‚    - approval_status         â”‚
â”‚      = 'approved'           â”‚  â”‚      = 'rejected'            â”‚
â”‚    - approval_notes = notes â”‚  â”‚    - approval_notes = reason â”‚
â”‚ 3. Call confirmCancel()     â”‚  â”‚ 3. No changes to PigSale     â”‚
â”‚    - Prepare pig return     â”‚  â”‚ 4. Redirect to dashboard    â”‚
â”‚    - Update PigSale:        â”‚  â”‚                              â”‚
â”‚      status='à¸¢à¸à¹€à¸¥à¸´à¸'        â”‚  â”‚ â†’ Keep sale ACTIVE          â”‚
â”‚      payment_status=        â”‚  â”‚ â†’ Keep buttons VISIBLE      â”‚
â”‚      'à¸¢à¸à¹€à¸¥à¸´à¸'               â”‚  â”‚ â†’ User can retry            â”‚
â”‚    - Return pigs            â”‚  â”‚                              â”‚
â”‚    - Update batch qty       â”‚  â”‚                              â”‚
â”‚ 4. Recalculate profit       â”‚  â”‚                              â”‚
â”‚    - RevenueHelper          â”‚  â”‚                              â”‚
â”‚    - Only active sales      â”‚  â”‚                              â”‚
â”‚ 5. Update notification:     â”‚  â”‚                              â”‚
â”‚    - Timestamp              â”‚  â”‚                              â”‚
â”‚    - Mark as done           â”‚  â”‚                              â”‚
â”‚ 6. Redirect to dashboard    â”‚  â”‚                              â”‚
â”‚                             â”‚  â”‚                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
          â”‚                               â”‚
          â”‚                               â”‚
          â†“ SUCCESS                       â†“ SUCCESS
          â”‚                               â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   MOVE TO APPROVED TAB      â”‚  â”‚  MOVE TO REJECTED TAB        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                             â”‚  â”‚                              â”‚
â”‚ âœ… à¸¢à¸à¹€à¸¥à¸´à¸à¸à¸²à¸£à¸‚à¸²à¸¢à¹à¸¥à¹‰à¸§ [3]    â”‚  â”‚ âŒ à¸›à¸à¸´à¹€à¸ªà¸˜à¸à¸²à¸£à¸¢à¸à¹€à¸¥à¸´à¸ [2]     â”‚
â”‚                             â”‚  â”‚                              â”‚
â”‚ Table: Approved             â”‚  â”‚ Table: Rejected              â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚  â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚ â”‚ Sale #5234 â”‚ 10 à¸•à¸±à¸§   â”‚ â”‚  â”‚ â”‚ Sale #5240â”‚ 12 à¸•à¸±à¸§   â”‚  â”‚â”‚
â”‚ â”‚ Approved: 10/1 14:30   â”‚ â”‚  â”‚ â”‚ Rejected: 09/30 16:45â”‚  â”‚â”‚
â”‚ â”‚ [ğŸ‘ View]              â”‚ â”‚  â”‚ â”‚ Reason: Data incomplete â”‚ â”‚â”‚
â”‚ â”‚                         â”‚ â”‚  â”‚ â”‚ [ğŸ‘ View]              â”‚ â”‚â”‚
â”‚ â”‚ Sale #5236 â”‚ 5 à¸•à¸±à¸§    â”‚ â”‚  â”‚ â”‚ Sale #5242â”‚ 7 à¸•à¸±à¸§    â”‚  â”‚â”‚
â”‚ â”‚ Approved: 10/1 14:25   â”‚ â”‚  â”‚ â”‚ Rejected: 09/30 15:20â”‚  â”‚â”‚
â”‚ â”‚ [ğŸ‘ View]              â”‚ â”‚  â”‚ â”‚ Reason: In processing â”‚ â”‚â”‚
â”‚ â”‚                         â”‚ â”‚  â”‚ â”‚ [ğŸ‘ View]              â”‚ â”‚â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚  â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”‚                             â”‚  â”‚                              â”‚
â”‚ DATABASE:                   â”‚  â”‚ DATABASE:                    â”‚
â”‚ - Notification.approval     â”‚  â”‚ - Notification.approval      â”‚
â”‚   status = 'approved'       â”‚  â”‚   status = 'rejected'        â”‚
â”‚ - PigSale.status = '        â”‚  â”‚ - PigSale.status            â”‚
â”‚   à¸¢à¸à¹€à¸¥à¸´à¸à¸à¸²à¸£à¸‚à¸²à¸¢'            â”‚  â”‚   (UNCHANGED)                â”‚
â”‚ - PigSale.payment_status    â”‚  â”‚ - PigSale.payment_status    â”‚
â”‚   = 'à¸¢à¸à¹€à¸¥à¸´à¸à¸à¸²à¸£à¸‚à¸²à¸¢'         â”‚  â”‚   (UNCHANGED)                â”‚
â”‚ - Profit updated            â”‚  â”‚ - Profit (UNCHANGED)        â”‚
â”‚ - Pigs returned             â”‚  â”‚ - Pigs (UNCHANGED)          â”‚
â”‚                             â”‚  â”‚                              â”‚
â”‚ PIG SALES INDEX:            â”‚  â”‚ PIG SALES INDEX:             â”‚
â”‚ Sale still visible BUT       â”‚  â”‚ Sale still visible AND       â”‚
â”‚ - No payment button         â”‚  â”‚ - Payment button visible     â”‚
â”‚ - No cancel button          â”‚  â”‚ - Cancel button visible      â”‚
â”‚ - Greyed out / disabled     â”‚  â”‚ - Enabled                    â”‚
â”‚                             â”‚  â”‚ - User can record payment    â”‚
â”‚                             â”‚  â”‚ - User can request cancel    â”‚
â”‚                             â”‚  â”‚   again (new notification)   â”‚
â”‚                             â”‚  â”‚                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
          â”‚                               â”‚
          â”‚                               â”‚
          â†“                               â†“
   PROCESS COMPLETE              USER CAN RETRY
   Sale cancelled                 Sale active
   Pigs returned                  Options:
   Profit updated               - Record payment
   Dashboard clean              - Request cancel again
                                - Ignore (admin feedback)


SYSTEM STATE COMPARISON:

BEFORE CANCEL REQUEST    AFTER APPROVAL      AFTER REJECTION
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
Sale Status:             Sale Status:         Sale Status:
 incomplete        â†’      à¸¢à¸à¹€à¸¥à¸´à¸à¸à¸²à¸£à¸‚à¸²à¸¢  vs   incomplete

Payment Status:          Payment Status:      Payment Status:
 à¸£à¸­à¸à¸²à¸£à¸­à¸™à¸¸à¸¡à¸±à¸•à¸´      â†’      à¸¢à¸à¹€à¸¥à¸´à¸à¸à¸²à¸£à¸‚à¸²à¸¢  vs   à¸£à¸­à¸à¸²à¸£à¸­à¸™à¸¸à¸¡à¸±à¸•à¸´

Pigs Location:           Pigs Location:       Pigs Location:
 batch/pen         â†’      returned       vs   batch/pen

Profit:                  Profit:              Profit:
 (base calc)       â†’      (recalculated) vs   (base calc)

Payment Button:          Payment Button:      Payment Button:
 VISIBLE           â†’      HIDDEN        vs    VISIBLE

Cancel Button:           Cancel Button:       Cancel Button:
 VISIBLE           â†’      HIDDEN        vs    VISIBLE

User Action:             User Action:         User Action:
 pending           â†’      COMPLETE            CAN RETRY


COMPLETE WORKFLOW LOOP:

    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚   USER REQUESTS CANCEL (PigSales)       â”‚
    â”‚   â†“                                      â”‚
    â”‚   Notification created (pending)         â”‚
    â”‚   â†“                                      â”‚
    â”‚   Admin sees in Payment Approvals        â”‚
    â”‚   â†“                                      â”‚
    â”‚   Admin clicks Approve/Reject            â”‚
    â”‚   â†“                                      â”‚
    â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚                  â”‚
    â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”
    â”‚  APPROVED   â”‚    â”‚  REJECTED   â”‚
    â”‚             â”‚    â”‚             â”‚
    â”‚ Sale:       â”‚    â”‚ Sale:       â”‚
    â”‚ Cancelled   â”‚    â”‚ Active      â”‚
    â”‚ Pigs:       â”‚    â”‚ Pigs:       â”‚
    â”‚ Returned    â”‚    â”‚ Unchanged   â”‚
    â”‚ Profit:     â”‚    â”‚ Profit:     â”‚
    â”‚ Updated     â”‚    â”‚ Unchanged   â”‚
    â”‚             â”‚    â”‚             â”‚
    â”‚ Buttons:    â”‚    â”‚ Buttons:    â”‚
    â”‚ Hidden      â”‚    â”‚ Visible     â”‚
    â”‚             â”‚    â”‚             â”‚
    â”‚ UI:         â”‚    â”‚ UI:         â”‚
    â”‚ Complete    â”‚    â”‚ Ready for   â”‚
    â”‚ (Done)      â”‚    â”‚ Retry       â”‚
    â”‚             â”‚    â”‚ â†“           â”‚
    â”‚             â”‚    â”‚ (Loop back  â”‚
    â”‚             â”‚    â”‚  to start)  â”‚
    â”‚             â”‚    â”‚             â”‚
    â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
           â”‚                  â”‚
           â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â”‚
           Both move to respective
           Approved/Rejected tabs
                  â”‚
           Dashboard shows history
                  â”‚
              COMPLETE


BADGE/COUNT CALCULATION:

Status Card:                    All pending items:
Pending: 8                    = Payments (3)
                              + Cancels (3)
                              + Pig Entries (2)
                              = 8 total

Approved: 25                  = Payments (10)
                              + Cancels (5)
                              + Pig Entries (10)
                              = 25 total

Rejected: 3                   = Payments (1)
                              + Cancels (2)
                              + Pig Entries (0)
                              = 3 total
```

## Data Model Relationships

```
User
  â”œâ”€ Notification (user_id)
  â”‚   â”œâ”€ type: 'cancel_pig_sale'
  â”‚   â”œâ”€ approval_status: 'pending'/'approved'/'rejected'
  â”‚   â”œâ”€ related_model: 'PigSale'
  â”‚   â”œâ”€ related_model_id: [id]
  â”‚   â””â”€ message: [cancel reason]
  â”‚
  â””â”€ PigSale (user_id = who recorded it)
      â”œâ”€ status: 'incomplete' â†’ 'à¸¢à¸à¹€à¸¥à¸´à¸à¸à¸²à¸£à¸‚à¸²à¸¢'
      â”œâ”€ payment_status: 'à¸£à¸­à¸à¸²à¸£à¸­à¸™à¸¸à¸¡à¸±à¸•à¸´' â†’ 'à¸¢à¸à¹€à¸¥à¸´à¸à¸à¸²à¸£à¸‚à¸²à¸¢'
      â”œâ”€ Batch (has many)
      â”‚   â””â”€ Quantity (updated on return)
      â””â”€ Revenue
          â””â”€ Profit (recalculated)
```

## API Endpoints

```
REQUEST:
  POST /pig-sales/{id}
  X-HTTP-METHOD-OVERRIDE: DELETE
  â†’ PigSaleController::destroy()
  â†’ Creates Notification

APPROVAL:
  PATCH /payment_approvals/{notificationId}/approve-cancel-sale
  {csrf_token, approval_notes}
  â†’ PaymentApprovalController::approveCancelSale()
  â†’ Calls PigSaleController::confirmCancel()

REJECTION:
  PATCH /payment_approvals/{notificationId}/reject-cancel-sale
  {csrf_token, rejection_reason}
  â†’ PaymentApprovalController::rejectCancelSale()
  â†’ Updates notification only
```

## Error Handling Flow

```
ERROR SCENARIOS:

1. Invalid Notification ID
   â†“
   Route not found / Notification::notFound()
   â†“
   Redirect to dashboard with error message

2. Unauthorized Access
   â†“
   Middleware check: Not admin
   â†“
   Redirect to home / 403 Forbidden

3. Database Error
   â†“
   Try/catch in controller
   â†“
   Log error
   â†“
   Redirect with generic error message

4. Validation Error (Reject without reason)
   â†“
   Validation fails on required field
   â†“
   Form returns with error message
   â†“
   User can correct and retry
```
